<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="XMLParser.Views.XmlWorkPage"
             x:Name="RootPage"
             BackgroundColor="{AppThemeBinding Light=#FFFFFF, Dark=#1C1C1E}"
             Padding="20">

    <Grid RowDefinitions="Auto,*"
          ColumnDefinitions="2*,5*,3*"
          ColumnSpacing="25"
          RowSpacing="20">

        <!-- ðŸ” Ð’ÐµÑ€Ñ…Ð½ÑÑ Ð¿Ð°Ð½ÐµÐ»ÑŒ -->
        <Grid Grid.Row="0" Grid.ColumnSpan="3"
            ColumnDefinitions="Auto,*,Auto,Auto,Auto,Auto"
            Padding="10,0,10,0">

            <HorizontalStackLayout Grid.Column="0" Spacing="10">
                <Button Text="â† ÐÐ°Ð·Ð°Ð´"
                        Clicked="OnHomeClicked"
                        BackgroundColor="#7C3AED"
                        TextColor="White"
                        CornerRadius="8"
                        HeightRequest="36"
                        Padding="15,0" />
                <Button Text="?"
                        Clicked="OnHelpClicked"
                        BackgroundColor="#7C3AED"
                        TextColor="White"
                        CornerRadius="8"
                        HeightRequest="36"
                        Padding="12,0" />
            </HorizontalStackLayout>

            <Label Grid.Column="1"
                Text="Ð Ð¾Ð±Ð¾Ñ‚Ð° Ð· XML"
                FontAttributes="Bold"
                FontSize="20"
                HorizontalOptions="Center"
                VerticalOptions="Center" />

            <!-- Ð‘ÐµÐ»Ñ‹Ðµ ÐºÐ½Ð¾Ð¿ÐºÐ¸ ÑÐ¿Ñ€Ð°Ð²Ð° (ÑƒÐ²ÐµÐ»Ð¸Ñ‡ÐµÐ½Ð½Ñ‹Ðµ Ð¸ Ñ Ð½Ð¾Ñ€Ð¼Ð°Ð»ÑŒÐ½Ñ‹Ð¼Ð¸ Ð¿Ð¾Ð´Ð¿Ð¸ÑÑÐ¼Ð¸) -->
            <HorizontalStackLayout Grid.Column="2" Grid.ColumnSpan="4"
                                HorizontalOptions="End"
                                Spacing="10">
                <Button Text="Ð—Ð±ÐµÑ€ÐµÐ³Ñ‚Ð¸ ÑÐº XML"
                        BackgroundColor="White"
                        TextColor="#7C3AED"
                        CornerRadius="8"
                        FontSize="13"
                        HeightRequest="36"
                        MinimumWidthRequest="130"
                        Padding="12,0"
                        Clicked="OnSaveXmlClicked" />
                <Button Text="Ð—Ð±ÐµÑ€ÐµÐ³Ñ‚Ð¸ ÑÐº HTML"
                        BackgroundColor="White"
                        TextColor="#7C3AED"
                        CornerRadius="8"
                        FontSize="13"
                        HeightRequest="36"
                        MinimumWidthRequest="130"
                        Padding="12,0"
                        Clicked="OnSaveHtmlClicked" />
                <Button Text="Ð—Ð±ÐµÑ€ÐµÐ³Ñ‚Ð¸ XML Ñƒ Drive"
                        BackgroundColor="White"
                        TextColor="#7C3AED"
                        CornerRadius="8"
                        FontSize="13"
                        HeightRequest="36"
                        MinimumWidthRequest="150"
                        Padding="12,0"
                        Clicked="OnSaveXmlDriveClicked" />
                <Button Text="Ð—Ð±ÐµÑ€ÐµÐ³Ñ‚Ð¸ HTML Ñƒ Drive"
                        BackgroundColor="White"
                        TextColor="#7C3AED"
                        CornerRadius="8"
                        FontSize="13"
                        HeightRequest="36"
                        MinimumWidthRequest="160"
                        Padding="12,0"
                        Clicked="OnSaveHtmlDriveClicked" />
            </HorizontalStackLayout>
        </Grid>

        <!-- ðŸ” Ð›ÐµÐ²Ð°Ñ Ð¿Ð°Ð½ÐµÐ»ÑŒ: ÐŸÐ¾Ð¸ÑÐº Ð¸ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ -->
        <ScrollView Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2">
            <VerticalStackLayout Spacing="20">

                <!-- ÐŸÐ¾Ð¸ÑÐº -->
                <Border BackgroundColor="{AppThemeBinding Light=#F5F3FA, Dark=#2C2C2E}"
                       Padding="20">
                    <VerticalStackLayout Spacing="10">
                        <Label Text="ÐŸÐ¾ÑˆÑƒÐº" FontAttributes="Bold" FontSize="16" />

                        <Entry Placeholder="ÐšÐ»ÑŽÑ‡Ð¾Ð²Ðµ ÑÐ»Ð¾Ð²Ð¾" Text="{Binding Keyword}" />
                        <Label Text="ÐžÐ±ÐµÑ€Ñ–Ñ‚ÑŒ Ð°Ñ‚Ñ€Ð¸Ð±ÑƒÑ‚"
                            FontSize="14"
                            FontAttributes="Bold"
                            TextColor="{AppThemeBinding Light=#000000, Dark=#FFFFFF}"
                            Margin="0,0,0,5" />
                        <Grid ColumnDefinitions="160,*" HeightRequest="44" HorizontalOptions="FillAndExpand">
                            <Picker
                                Grid.Column="0"
                                ItemsSource="{Binding AttrKeys}"
                                SelectedItem="{Binding SelectedAttrKey}"
                                BackgroundColor="{AppThemeBinding Light=#FFFFFF, Dark=#2C2C2E}"
                                TextColor="{AppThemeBinding Light=#000000, Dark=#FFFFFF}"
                                VerticalOptions="Center"
                                HorizontalOptions="Fill"
                                Margin="0" />

                            <Entry
                                Grid.Column="1"
                                Placeholder="Ð—Ð½Ð°Ñ‡ÐµÐ½Ð½Ñ"
                                Text="{Binding NewAttrValue}"
                                BackgroundColor="{AppThemeBinding Light=#FFFFFF, Dark=#2C2C2E}"
                                TextColor="{AppThemeBinding Light=#000000, Dark=#FFFFFF}"
                                VerticalOptions="Center"
                                HorizontalOptions="FillAndExpand"
                                Margin="10,0,0,0"
                                HeightRequest="44" />
                        </Grid>

                        <Button Text="Ð”Ð¾Ð´Ð°Ñ‚Ð¸ Ñ„Ñ–Ð»ÑŒÑ‚Ñ€"
                                BackgroundColor="#7C3AED"
                                TextColor="White"
                                CornerRadius="10"
                                HeightRequest="45"
                                Command="{Binding AddFilterCommand}" />
                    </VerticalStackLayout>
                </Border>

                <!-- Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ -->
                <VerticalStackLayout Spacing="10">
                    <Label Text="Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð¸"
                           FontAttributes="Bold"
                           FontSize="16" />
                    <CollectionView ItemsSource="{Binding ResultLines}">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Border BackgroundColor="{AppThemeBinding Light=#F2F2F7, Dark=#3A3A3C}"
                                       Padding="10"
                                       Margin="0,4,0,0">
                                    <Label Text="{Binding .}" FontSize="13" LineBreakMode="WordWrap" />
                                </Border>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>

            </VerticalStackLayout>
        </ScrollView>

        <!-- ðŸŽ¯ ÐŸÑ€Ð°Ð²Ð°Ñ ÐºÐ¾Ð»Ð¾Ð½ÐºÐ°: Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ñ‹ -->
        <ScrollView Grid.Row="1" Grid.Column="2">
            <VerticalStackLayout Spacing="15">

                <Border BackgroundColor="{AppThemeBinding Light=#F5F3FA, Dark=#2C2C2E}"
                       Padding="20">
                    <VerticalStackLayout Spacing="10">

                        <Label Text="ÐÐºÑ‚Ð¸Ð²Ð½Ñ– Ñ„Ñ–Ð»ÑŒÑ‚Ñ€Ð¸"
                               FontAttributes="Bold"
                               FontSize="16" />

                        <CollectionView ItemsSource="{Binding ActiveFilters}">
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <Border BackgroundColor="#E6DEFF"
                                           Padding="6"
                                           Margin="0,3,0,0">
                                        <HorizontalStackLayout VerticalOptions="Center">
                                            <Label Text="{Binding Display}"
                                                   VerticalOptions="Center"
                                                   FontSize="13"
                                                   LineBreakMode="TailTruncation" />
                                            <Button Text="âœ•"
                                                    FontSize="12"
                                                    BackgroundColor="Transparent"
                                                    TextColor="Red"
                                                    Padding="5,0"
                                                    Command="{Binding BindingContext.RemoveFilterCommand, Source={x:Reference RootPage}}"
                                                    CommandParameter="{Binding Key}"
                                                    HorizontalOptions="End"
                                                    VerticalOptions="Center" />
                                        </HorizontalStackLayout>
                                    </Border>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>

                        <Button Text="ÐžÑ‡Ð¸ÑÑ‚Ð¸Ñ‚Ð¸ Ñ„Ñ–Ð»ÑŒÑ‚Ñ€Ð¸"
                                BackgroundColor="{AppThemeBinding Light=#E5E5EA, Dark=#3A3A3C}"
                                TextColor="{AppThemeBinding Light=#000000, Dark=#FFFFFF}"
                                CornerRadius="10"
                                HeightRequest="40"
                                Command="{Binding ClearCommand}" />
                    </VerticalStackLayout>
                </Border>

                <Border BackgroundColor="{AppThemeBinding Light=#F5F3FA, Dark=#2C2C2E}"
                       Padding="20">
                    <VerticalStackLayout>
                        <Label Text="ÐÐ»Ð³Ð¾Ñ€Ð¸Ñ‚Ð¼ Ð¿Ð¾ÑˆÑƒÐºÑƒ"
                               FontAttributes="Bold"
                               FontSize="16" />
                        <Picker Title="ÐžÐ±Ñ€Ð°Ñ‚Ð¸ ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ñ–ÑŽ"
                                ItemsSource="{Binding Strategies}"
                                SelectedItem="{Binding SelectedStrategy}" />
                    </VerticalStackLayout>
                </Border>
            </VerticalStackLayout>
        </ScrollView>

        <ActivityIndicator x:Name="LoadingIndicator"
                           Grid.RowSpan="2"
                           Grid.ColumnSpan="3"
                           IsVisible="False"
                           IsRunning="False"
                           Color="#7C3AED"
                           WidthRequest="48"
                           HeightRequest="48"
                           HorizontalOptions="Center"
                           VerticalOptions="Center" />
    </Grid>
</ContentPage>
